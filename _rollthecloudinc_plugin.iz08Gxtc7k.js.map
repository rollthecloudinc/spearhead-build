{
  "version": 3,
  "sources": ["../../@rollthecloudinc/plugin/fesm2022/rollthecloudinc-plugin.mjs"],
  "sourcesContent": ["import * as i0 from '@angular/core';\nimport { NgModule, Injectable } from '@angular/core';\nimport * as i2 from '@rollthecloudinc/utils';\nimport { UtilsModule } from '@rollthecloudinc/utils';\nimport { of, forkJoin } from 'rxjs';\nimport { map, switchMap } from 'rxjs/operators';\nlet PluginModule = /*#__PURE__*/(() => {\n  class PluginModule {\n    static {\n      this.\u0275fac = function PluginModule_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || PluginModule)();\n      };\n    }\n    static {\n      this.\u0275mod = /* @__PURE__ */i0.\u0275\u0275defineNgModule({\n        type: PluginModule\n      });\n    }\n    static {\n      this.\u0275inj = /* @__PURE__ */i0.\u0275\u0275defineInjector({\n        imports: [UtilsModule]\n      });\n    }\n  }\n  return PluginModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet PluginConfigurationManager = /*#__PURE__*/(() => {\n  class PluginConfigurationManager {\n    constructor() {\n      this.configs = [];\n    }\n    addConfig(cfg) {\n      this.configs.push(cfg);\n    }\n    getConfigs() {\n      return this.configs;\n    }\n    static {\n      this.\u0275fac = function PluginConfigurationManager_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || PluginConfigurationManager)();\n      };\n    }\n    static {\n      this.\u0275prov = /* @__PURE__ */i0.\u0275\u0275defineInjectable({\n        token: PluginConfigurationManager,\n        factory: PluginConfigurationManager.\u0275fac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return PluginConfigurationManager;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet ConfigDiscovery = /*#__PURE__*/(() => {\n  class ConfigDiscovery {\n    constructor(pcm, moduleLoader) {\n      this.pcm = pcm;\n      this.moduleLoader = moduleLoader;\n    }\n    loadPlugins(pluginDef, ids = []) {\n      const configs = this.pcm.getConfigs();\n      const len = configs.length;\n      const loadModules$ = [];\n      for (let i = 0; i < len; i++) {\n        const len2 = configs[i].modules.length;\n        for (let j = 0; j < len2; j++) {\n          if (configs[i].modules[j].plugins.has(pluginDef.name) && (ids.length === 0 || ids.some(id => configs[i].modules[j].plugins.get(pluginDef.name).findIndex(p => p === id) > -1))) {\n            loadModules$.push(this.moduleLoader.loadModule(configs[i].modules[j].module));\n          }\n        }\n      }\n      if (loadModules$.length === 0) {\n        return of(true);\n      } else {\n        return forkJoin(loadModules$).pipe(map(() => true));\n      }\n    }\n    static {\n      this.\u0275fac = function ConfigDiscovery_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ConfigDiscovery)(i0.\u0275\u0275inject(PluginConfigurationManager), i0.\u0275\u0275inject(i2.ModuleLoaderService));\n      };\n    }\n    static {\n      this.\u0275prov = /* @__PURE__ */i0.\u0275\u0275defineInjectable({\n        token: ConfigDiscovery,\n        factory: ConfigDiscovery.\u0275fac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return ConfigDiscovery;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n// import { Injectable } from '@angular/core';\n// @Injectable()\nclass BasePluginManager {\n  constructor(pcm, moduleLoader) {\n    this.pcm = pcm;\n    this.moduleLoader = moduleLoader;\n    this.pluginInstances = new Map();\n    this.discoveryPipeline = [];\n    this.discovery();\n  }\n  discovery() {\n    this.discoveryPipeline.push(new ConfigDiscovery(this.pcm, this.moduleLoader));\n  }\n  addDiscovery(d) {\n    this.discoveryPipeline.push(d);\n  }\n  register(plugin) {\n    this.pluginInstances.set(plugin.id, plugin);\n  }\n  getPlugins(ids) {\n    const newPlugins = ids ? ids.filter(id => !this.pluginInstances.has(id)) : [];\n    if (ids && newPlugins.length === 0) {\n      return of(new Map(ids.map(id => [id, this.pluginInstances.get(id)])));\n    } else {\n      return this.pluginDef().pipe(switchMap(def => forkJoin(this.discoveryPipeline.map(d => d.loadPlugins(def, newPlugins))).pipe(map(() => ids ? new Map(ids.map(id => [id, this.pluginInstances.get(id)])) : this.pluginInstances))));\n    }\n  }\n  getPlugin(id) {\n    if (this.pluginInstances.has(id)) {\n      return of(this.pluginInstances.get(id));\n    } else {\n      return this.pluginDef().pipe(switchMap(def => forkJoin(this.discoveryPipeline.map(d => d.loadPlugins(def, [id]))).pipe(map(() => this.pluginInstances.get(id)))));\n    }\n  }\n}\nclass PluginConfig {\n  constructor(data) {\n    this.modules = [];\n    if (data) {\n      if (data.modules) {\n        this.modules = data.modules.map(m => new PluginConfigModule(m));\n      }\n    }\n  }\n}\nclass Plugin {\n  constructor(data) {\n    if (data) {\n      this.id = data.id;\n      this.title = data.title;\n    }\n  }\n}\nclass PluginDef {\n  constructor(data) {\n    if (data) {\n      this.name = data.name;\n    }\n  }\n}\nclass PluginConfigModule {\n  constructor(data) {\n    if (data) {\n      this.module = data.module;\n      if (data.plugins) {\n        this.plugins = new Map([...data.plugins]);\n      }\n    }\n  }\n}\n/*export class BasePlugin implements Plugin {\n}*/\n\n/*\n * Public API Surface of plugin\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { BasePluginManager, ConfigDiscovery, Plugin, PluginConfig, PluginConfigModule, PluginConfigurationManager, PluginDef, PluginModule };\n"],
  "mappings": "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",
  "names": ["i0", "i2", "UtilsModule", "of", "forkJoin", "map", "switchMap", "PluginModule", "__ngFactoryType__", "PluginConfigurationManager", "cfg", "ConfigDiscovery", "pcm", "moduleLoader", "pluginDef", "ids", "configs", "len", "loadModules$", "i", "len2", "j", "id", "p", "BasePluginManager", "d", "plugin", "newPlugins", "def", "PluginConfig", "data", "m", "PluginConfigModule", "Plugin", "PluginDef"]
}
