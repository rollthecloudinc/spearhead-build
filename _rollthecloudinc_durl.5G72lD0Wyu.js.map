{
  "version": 3,
  "sources": ["../../@rollthecloudinc/durl/fesm2022/rollthecloudinc-durl.mjs"],
  "sourcesContent": ["import * as i0 from '@angular/core';\nimport { NgModule, Injectable } from '@angular/core';\nimport * as i2 from '@rollthecloudinc/dparam';\nimport { ParamPlugin, DparamModule } from '@rollthecloudinc/dparam';\nimport { of, forkJoin } from 'rxjs';\nimport { getRouterSelectors } from '@ngrx/router-store';\nimport * as i1 from '@ngrx/store';\nimport { select } from '@ngrx/store';\nimport { map, switchMap, defaultIfEmpty, tap } from 'rxjs/operators';\nimport * as qs from 'qs';\nconst paramPagePluginFactory = () => {\n  return new ParamPlugin({\n    id: 'page',\n    title: 'Page',\n    usedContexts: () => of(['_page']),\n    condition: ({\n      param,\n      metadata\n    }) => {\n      return param.flags.findIndex(f => f.enabled && f.name === 'page') > -1 && metadata.has('page');\n    },\n    evalParam: ({\n      param,\n      metadata\n    }) => {\n      return of(`${metadata.get('page')}`);\n    }\n  });\n};\nconst paramSearchStringPluginFactory = () => {\n  return new ParamPlugin({\n    id: 'searchstring',\n    title: 'Searchstring',\n    condition: ({\n      param,\n      metadata\n    }) => {\n      return param.flags.findIndex(f => f.enabled) > -1 && metadata.has('searchString');\n    },\n    evalParam: ({\n      param,\n      metadata\n    }) => {\n      return of(`${metadata.get('searchString')}`);\n    }\n  });\n};\nconst paramRoutePluginFactory = () => {\n  return new ParamPlugin({\n    id: 'route',\n    title: 'Route',\n    usedContexts: () => of(['_route']),\n    evalParam: ({\n      param,\n      metadata\n    }) => {\n      const route = metadata.get('_route');\n      return of(route.params[param.mapping.value]);\n    }\n  });\n};\nconst paramQueryStringPluginFactory = () => {\n  return new ParamPlugin({\n    id: 'querystring',\n    title: 'Querystring',\n    usedContexts: () => of(['_page']),\n    evalParam: ({\n      param,\n      metadata\n    }) => {\n      const route = metadata.get('_route');\n      return of(route.queryParams[param.mapping.value]);\n    }\n  });\n};\nconst paramStandardPaginationPluginFactory = () => {\n  return new ParamPlugin({\n    id: 'standardpagination',\n    title: 'Standard Pagination',\n    usedContexts: () => of(['_page']),\n    condition: ({\n      param,\n      metadata\n    }) => {\n      return param.flags.findIndex(f => f.enabled && f.name === 'offset') > -1 && metadata.has('limit') && metadata.has('page');\n    },\n    evalParam: ({\n      param,\n      metadata\n    }) => {\n      return of(`${+metadata.get('limit') * (+metadata.get('page') - 1)}`);\n    }\n  });\n};\nlet DurlModule = /*#__PURE__*/(() => {\n  class DurlModule {\n    constructor(ppm) {\n      [paramPagePluginFactory(), paramSearchStringPluginFactory(), paramRoutePluginFactory(), paramQueryStringPluginFactory(), paramStandardPaginationPluginFactory()].forEach(p => ppm.register(p));\n    }\n    static {\n      this.\u0275fac = function DurlModule_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || DurlModule)(i0.\u0275\u0275inject(i2.ParamPluginManager));\n      };\n    }\n    static {\n      this.\u0275mod = /* @__PURE__ */i0.\u0275\u0275defineNgModule({\n        type: DurlModule\n      });\n    }\n    static {\n      this.\u0275inj = /* @__PURE__ */i0.\u0275\u0275defineInjector({\n        imports: [DparamModule]\n      });\n    }\n  }\n  return DurlModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet UrlGeneratorService = /*#__PURE__*/(() => {\n  class UrlGeneratorService {\n    constructor(routerStore, paramPluginManager, paramEvaluatorService) {\n      this.routerStore = routerStore;\n      this.paramPluginManager = paramPluginManager;\n      this.paramEvaluatorService = paramEvaluatorService;\n    }\n    getUrl(url, params, metadata) {\n      const {\n        selectCurrentRoute\n      } = getRouterSelectors();\n      return this.routerStore.pipe(select(selectCurrentRoute), map(route => [route, url, url ? url.indexOf('?') : -1]), map(([route, url, index]) => [route, index > -1 ? url.substring(0, index) : url, index > -1 ? url.substring(index + 1) : '']), switchMap(([route, path, queryString]) => {\n        const qsParsed = qs.parse(queryString);\n        const pathPieces = path ? path.split('/') : [];\n        const meta = new Map([...metadata, ['_route', route]]);\n        const paramNames = this.paramNames(url);\n        const mappings = params.reduce((p, c, i) => new Map([...p, [paramNames[i], c]]), new Map());\n        const path$ = pathPieces.reduce((p, c, i) => {\n          if (c.indexOf(':') === 0) {\n            return [...p, this.paramEvaluatorService.paramValue(mappings.get(c /*.substr(1)*/), meta)];\n          } else {\n            return [...p, of(pathPieces[i])];\n          }\n        }, []);\n        const qs$ = [];\n        for (const prop in qsParsed) {\n          if (Array.isArray(qsParsed[prop])) {\n            qsParsed[prop].forEach(p => qs$.push(this.paramEvaluatorService.paramValue(mappings.get(p), meta).pipe(map(v => [prop, v, true]))));\n          } else if (typeof qsParsed[prop] === 'string' && qsParsed[prop].indexOf(':') > -1) {\n            qs$.push(this.paramEvaluatorService.paramValue(mappings.get(qsParsed[prop] /*.substr(1)*/), meta).pipe(map(v => [prop, v, false])));\n          } else {\n            qs$.push(of([prop, qsParsed[prop], Array.isArray(qsParsed[prop])]));\n          }\n        }\n        return forkJoin([forkJoin(path$).pipe(map(p => p.filter(v => v !== undefined && v !== null && v !== '' && v !== 'undefined').map((v, index) => index === 0 && v.indexOf('http') === 0 ? `${v}/` : v).join('/')), defaultIfEmpty(path)), forkJoin(qs$).pipe(tap(q => console.log(q)), map(q => q.reduce((p, [n, v, m]) => {\n          if (v === undefined || v === null || v === '' || v === 'undefined') {\n            const p2 = {\n              ...p\n            };\n            delete p2[n];\n            return p2;\n          } else {\n            return m ? {\n              ...p,\n              [n]: [...(p[n] !== undefined ? p[n] : []), v]\n            } : {\n              ...p,\n              [n]: v\n            };\n          }\n        }, this.rebuildQueryString(qsParsed))), tap(q => console.log(q)), map(q => qs.stringify(q, {\n          arrayFormat: 'repeat',\n          indices: false\n        })), defaultIfEmpty(queryString))]).pipe(map(r => r.join('?')));\n      }));\n    }\n    paramNames(url) {\n      const indexPos = url ? url.indexOf('?') : -1;\n      const pathParsed = (indexPos > -1 ? url.substring(0, indexPos) : url ? url : '').split('/').reduce((p, c, i) => c.indexOf(':') === 0 ? {\n        ...p,\n        [c.substr(1)]: c\n      } : p, {});\n      const parsed = {\n        ...pathParsed,\n        ...qs.parse(url ? url.substring(url.indexOf('?') + 1) : '')\n      };\n      const paramNames = [];\n      for (const param in parsed) {\n        if (Array.isArray(parsed[param])) {\n          parsed[param].forEach(p => paramNames.push(p));\n        } else if (parsed[param].indexOf(':') === 0) {\n          paramNames.push(parsed[param]);\n        }\n      }\n      return paramNames;\n    }\n    rebuildQueryString(q) {\n      const newQ = {};\n      for (const p in q) {\n        if (Array.isArray(q[p])) {\n          newQ[p] = [];\n        } else if (p[q] !== undefined && p[q] !== null && p[q] !== '' && p[q] !== 'undefined') {\n          newQ[p] = p[q];\n        }\n      }\n      return qs.parse(newQ);\n    }\n    static {\n      this.\u0275fac = function UrlGeneratorService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || UrlGeneratorService)(i0.\u0275\u0275inject(i1.Store), i0.\u0275\u0275inject(i2.ParamPluginManager), i0.\u0275\u0275inject(i2.ParamEvaluatorService));\n      };\n    }\n    static {\n      this.\u0275prov = /* @__PURE__ */i0.\u0275\u0275defineInjectable({\n        token: UrlGeneratorService,\n        factory: UrlGeneratorService.\u0275fac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return UrlGeneratorService;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/*\n * Public API Surface of durl\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { DurlModule, UrlGeneratorService };\n"],
  "mappings": "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",
  "names": ["i0", "i2", "ParamPlugin", "DparamModule", "of", "forkJoin", "getRouterSelectors", "i1", "select", "map", "switchMap", "defaultIfEmpty", "tap", "qs", "paramPagePluginFactory", "ParamPlugin", "of", "param", "metadata", "f", "paramSearchStringPluginFactory", "paramRoutePluginFactory", "route", "paramQueryStringPluginFactory", "paramStandardPaginationPluginFactory", "DurlModule", "ppm", "p", "__ngFactoryType__", "DparamModule", "UrlGeneratorService", "routerStore", "paramPluginManager", "paramEvaluatorService", "url", "params", "selectCurrentRoute", "getRouterSelectors", "select", "map", "index", "switchMap", "path", "queryString", "qsParsed", "pathPieces", "meta", "paramNames", "mappings", "c", "i", "path$", "qs$", "prop", "v", "forkJoin", "defaultIfEmpty", "tap", "q", "n", "m", "p2", "__spreadValues", "__spreadProps", "indexPos", "pathParsed", "parsed", "newQ"]
}
