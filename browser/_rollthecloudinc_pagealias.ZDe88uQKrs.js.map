{
  "version": 3,
  "sources": ["../../@rollthecloudinc/pagealias/fesm2022/rollthecloudinc-pagealias.mjs"],
  "sourcesContent": ["import { CommonModule } from '@angular/common';\nimport * as i0 from '@angular/core';\nimport { Component, Inject, NgModule } from '@angular/core';\nimport { SITE_NAME } from '@rollthecloudinc/utils';\nimport * as i1 from '@rollthecloudinc/alias';\nimport { AliasPlugin } from '@rollthecloudinc/alias';\nimport { map, tap, catchError } from 'rxjs/operators';\nimport { PanelPage } from '@rollthecloudinc/panels';\nimport { PanelPageRouterComponent, createMatcher, EditPanelPageComponent, createEditMatcher } from '@rollthecloudinc/pages';\nimport { of } from 'rxjs';\nimport * as i2 from '@angular/router';\nimport * as i3 from '@ngrx/data';\nlet PagealiasRouterComponent = /*#__PURE__*/(() => {\n  class PagealiasRouterComponent {\n    static {\n      this.\u0275fac = function PagealiasRouterComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || PagealiasRouterComponent)();\n      };\n    }\n    static {\n      this.\u0275cmp = /* @__PURE__ */i0.\u0275\u0275defineComponent({\n        type: PagealiasRouterComponent,\n        selectors: [[\"classifieds-pagealias-router\"]],\n        standalone: false,\n        decls: 2,\n        vars: 0,\n        template: function PagealiasRouterComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.\u0275\u0275elementStart(0, \"p\");\n            i0.\u0275\u0275text(1, \"Hello\");\n            i0.\u0275\u0275elementEnd();\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return PagealiasRouterComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nclass PagealiasPlugin extends AliasPlugin {}\nclass PagealiasLoadingStrategy {\n  get panelPageListItemsService() {\n    return this.es.getEntityCollectionService('PanelPageListItem');\n  }\n  constructor(siteName, es, router) {\n    this.siteName = siteName;\n    this.es = es;\n    this.router = router;\n    this.routesLoaded = false;\n  }\n  isLoaded() {\n    return this.routesLoaded;\n  }\n  load() {\n    return this.panelPageListItemsService.getWithQuery(`site=${encodeURIComponent(`{\"term\":{\"site.keyword\":{\"value\":\"${this.siteName}\"}}}`)}&path=${encodeURIComponent(`{\"wildcard\":{\"path.keyword\":{\"value\":\"*\"}}}`)}`).pipe(map(pp => pp.filter(p => p.path !== undefined && p.path !== '')), map(pp => pp.map(o => new PanelPage(o)).sort((a, b) => {\n      if (a.path.split('/').length === b.path.split('/').length) {\n        return a.path.split('/')[a.path.split('/').length - 1] > b.path.split('/')[b.path.split('/').length - 1] ? -1 : 1;\n      }\n      return a.path.split('/').length > b.path.split('/').length ? -1 : 1;\n    })), tap(pp => pp.sort((a, b) => a.path.length > b.path.length ? 1 : -1)), tap(pp => {\n      pp.forEach(p => {\n        this.router.config.unshift({\n          matcher: createMatcher(p),\n          component: PanelPageRouterComponent,\n          data: {\n            panelPageListItem: p\n          }\n        });\n        this.router.config.unshift({\n          matcher: createEditMatcher(p),\n          component: EditPanelPageComponent,\n          data: {\n            panelPageListItem: p\n          }\n        });\n      });\n      this.routesLoaded = true;\n    }), tap(() => console.log('panels routes loaded')), map(() => true));\n  }\n}\nclass PagealiasMatchingStrategy {\n  get panelPageListItemsService() {\n    return this.es.getEntityCollectionService('PanelPageListItem');\n  }\n  constructor(siteName, es, router) {\n    this.siteName = siteName;\n    this.es = es;\n    this.router = router;\n  }\n  match(state) {\n    let url = state.url;\n    if (url.indexOf('?') !== -1) {\n      url = state.url.substr(0, url.indexOf('?'));\n    }\n    const matchPathQuery = 'path=' + url.substr(1).split('/').reduce((p, c, i) => [...p, i === 0 ? `/${c}` : `${p[i - 1]}/${c}`], []).map(p => this.encodePathComponent(p)).join('&path=') + `&site=${encodeURIComponent(`{\"term\":{\"site.keyword\":{\"value\":\"${this.siteName}\"}}}`)}`;\n    return this.panelPageListItemsService.getWithQuery(matchPathQuery).pipe(catchError(e => {\n      return of([]);\n    }), map(pages => pages.reduce((p, c) => p === undefined ? c : p.path.split('/').length < c.path.split('/').length ? c : p, undefined)), map(m => !!m || state.url.indexOf('pages') > -1));\n  }\n  encodePathComponent(v) {\n    return `{\"term\":{\"path.keyword\":{\"value\":\"${v}\"}}}`;\n  }\n}\nclass PagealiasRedirectHandler {\n  get panelPageListItemsService() {\n    return this.es.getEntityCollectionService('PanelPageListItem');\n  }\n  constructor(siteName, es, router) {\n    this.siteName = siteName;\n    this.es = es;\n    this.router = router;\n  }\n  redirect(route, state) {\n    if (state.url.indexOf('pages') > -1) {\n      console.log(`redirect: ${state.url}`);\n      this.router.navigateByUrl(state.url);\n    } else {\n      let url = state.url;\n      if (url.indexOf('?') !== -1) {\n        url = state.url.substr(0, url.indexOf('?'));\n      }\n      const matchPathQuery = 'path=' + url.substr(1).split('/').reduce((p, c, i) => [...p, i === 0 ? `/${c}` : `${p[i - 1]}/${c}`], []).map(p => this.encodePathComponent(p)).join('&path=') + `&site=${encodeURIComponent(`{\"term\":{\"site.keyword\":{\"value\":\"${this.siteName}\"}}}`)}`;\n      this.panelPageListItemsService.getWithQuery(matchPathQuery).pipe(map(pages => pages.reduce((p, c) => p === undefined ? c : p.path.split('/').length < c.path.split('/').length ? c : p, undefined)), map(panelPage => {\n        const argPath = state.url.substr(1).split('/').slice(panelPage.path.split('/').length - 1).join('/');\n        return [panelPage, argPath];\n      })).subscribe(([panelPage, argPath]) => {\n        // this.router.onSameUrlNavigation;\n        this.router.navigate(['reload']);\n        // console.log(`nagigvate to: ${panelPage.path}${argPath === '' ? '' : `/${argPath}`}?${qs.stringify(route.queryParams)}`);\n        // this.router.navigateByUrl(`${panelPage.path}${argPath === '' ? '' : `/${argPath}`}?${qs.stringify(route.queryParams)}`, /* Removed unsupported properties by Angular migration: queryParams, fragment. */ {})\n        // this.router.navigateByUrl(`/pages/panelpage/${panelPage.id}${argPath === '' ? '' : `/${argPath}`}?${qs.stringify(route.queryParams)}`, {queryParams: { ...((route as ActivatedRouteSnapshot).queryParams) }, fragment: (route as ActivatedRouteSnapshot).fragment })\n      });\n    }\n  }\n  encodePathComponent(v) {\n    return `{\"term\":{\"path.keyword\":{\"value\":\"${v}\"}}}`;\n  }\n}\nconst pagealiasFactory = (siteName, es, router) => {\n  const loadingStrategy = new PagealiasLoadingStrategy(siteName, es, router);\n  const matchingStrategy = new PagealiasMatchingStrategy(siteName, es, router);\n  const redirectHandler = new PagealiasRedirectHandler(siteName, es, router);\n  return new PagealiasPlugin({\n    id: 'panels',\n    title: 'Panels',\n    loadingStrategy,\n    matchingStrategy,\n    redirectHandler\n  });\n};\nlet PagealiasModule = /*#__PURE__*/(() => {\n  class PagealiasModule {\n    constructor(apm, router, siteName,\n    // eds: EntityDefinitionService,\n    es) {\n      // eds.registerMetadataMap(entityMetadata);\n      apm.register(pagealiasFactory(siteName, es, router));\n    }\n    static {\n      this.\u0275fac = function PagealiasModule_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || PagealiasModule)(i0.\u0275\u0275inject(i1.AliasPluginManager), i0.\u0275\u0275inject(i2.Router), i0.\u0275\u0275inject(SITE_NAME), i0.\u0275\u0275inject(i3.EntityServices));\n      };\n    }\n    static {\n      this.\u0275mod = /* @__PURE__ */i0.\u0275\u0275defineNgModule({\n        type: PagealiasModule\n      });\n    }\n    static {\n      this.\u0275inj = /* @__PURE__ */i0.\u0275\u0275defineInjector({\n        imports: [CommonModule]\n      });\n    }\n  }\n  return PagealiasModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/*\n * Public API Surface of pagealias\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PagealiasModule };\n"],
  "mappings": "4BAAA,OAAS,gBAAAA,MAAoB,kBAC7B,UAAYC,MAAQ,gBACpB,MAA4C,gBAC5C,OAAS,aAAAC,MAAiB,yBAC1B,UAAYC,MAAQ,yBACpB,OAAS,eAAAC,MAAmB,yBAC5B,OAAS,OAAAC,EAAK,OAAAC,EAAK,cAAAC,MAAkB,iBACrC,OAAS,aAAAC,MAAiB,0BAC1B,OAAS,4BAAAC,EAA0B,iBAAAC,EAAe,0BAAAC,EAAwB,qBAAAC,MAAyB,yBACnG,OAAS,MAAAC,MAAU,OACnB,UAAYC,MAAQ,kBACpB,UAAYC,MAAQ,aA+BpB,IAAMC,EAAN,cAA8BC,CAAY,CAAC,EACrCC,EAAN,KAA+B,CAC7B,IAAI,2BAA4B,CAC9B,OAAO,KAAK,GAAG,2BAA2B,mBAAmB,CAC/D,CACA,YAAYC,EAAUC,EAAIC,EAAQ,CAChC,KAAK,SAAWF,EAChB,KAAK,GAAKC,EACV,KAAK,OAASC,EACd,KAAK,aAAe,EACtB,CACA,UAAW,CACT,OAAO,KAAK,YACd,CACA,MAAO,CACL,OAAO,KAAK,0BAA0B,aAAa,QAAQ,mBAAmB,qCAAqC,KAAK,QAAQ,MAAM,CAAC,SAAS,mBAAmB,6CAA6C,CAAC,EAAE,EAAE,KAAKC,EAAIC,GAAMA,EAAG,OAAOC,GAAKA,EAAE,OAAS,QAAaA,EAAE,OAAS,EAAE,CAAC,EAAGF,EAAIC,GAAMA,EAAG,IAAIE,GAAK,IAAIC,EAAUD,CAAC,CAAC,EAAE,KAAK,CAACE,EAAGC,IACvUD,EAAE,KAAK,MAAM,GAAG,EAAE,SAAWC,EAAE,KAAK,MAAM,GAAG,EAAE,OAC1CD,EAAE,KAAK,MAAM,GAAG,EAAEA,EAAE,KAAK,MAAM,GAAG,EAAE,OAAS,CAAC,EAAIC,EAAE,KAAK,MAAM,GAAG,EAAEA,EAAE,KAAK,MAAM,GAAG,EAAE,OAAS,CAAC,EAAI,GAAK,EAE3GD,EAAE,KAAK,MAAM,GAAG,EAAE,OAASC,EAAE,KAAK,MAAM,GAAG,EAAE,OAAS,GAAK,CACnE,CAAC,EAAGC,EAAIN,GAAMA,EAAG,KAAK,CAACI,EAAGC,IAAMD,EAAE,KAAK,OAASC,EAAE,KAAK,OAAS,EAAI,EAAE,CAAC,EAAGC,EAAIN,GAAM,CACnFA,EAAG,QAAQC,GAAK,CACd,KAAK,OAAO,OAAO,QAAQ,CACzB,QAASM,EAAcN,CAAC,EACxB,UAAWO,EACX,KAAM,CACJ,kBAAmBP,CACrB,CACF,CAAC,EACD,KAAK,OAAO,OAAO,QAAQ,CACzB,QAASQ,EAAkBR,CAAC,EAC5B,UAAWS,EACX,KAAM,CACJ,kBAAmBT,CACrB,CACF,CAAC,CACH,CAAC,EACD,KAAK,aAAe,EACtB,CAAC,EAAGK,EAAI,IAAM,QAAQ,IAAI,sBAAsB,CAAC,EAAGP,EAAI,IAAM,EAAI,CAAC,CACrE,CACF,EACMY,EAAN,KAAgC,CAC9B,IAAI,2BAA4B,CAC9B,OAAO,KAAK,GAAG,2BAA2B,mBAAmB,CAC/D,CACA,YAAYf,EAAUC,EAAIC,EAAQ,CAChC,KAAK,SAAWF,EAChB,KAAK,GAAKC,EACV,KAAK,OAASC,CAChB,CACA,MAAMc,EAAO,CACX,IAAIC,EAAMD,EAAM,IACZC,EAAI,QAAQ,GAAG,IAAM,KACvBA,EAAMD,EAAM,IAAI,OAAO,EAAGC,EAAI,QAAQ,GAAG,CAAC,GAE5C,IAAMC,EAAiB,QAAUD,EAAI,OAAO,CAAC,EAAE,MAAM,GAAG,EAAE,OAAO,CAACZ,EAAGc,EAAGC,IAAM,CAAC,GAAGf,EAAGe,IAAM,EAAI,IAAID,CAAC,GAAK,GAAGd,EAAEe,EAAI,CAAC,CAAC,IAAID,CAAC,EAAE,EAAG,CAAC,CAAC,EAAE,IAAId,GAAK,KAAK,oBAAoBA,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAI,SAAS,mBAAmB,qCAAqC,KAAK,QAAQ,MAAM,CAAC,GAC9Q,OAAO,KAAK,0BAA0B,aAAaa,CAAc,EAAE,KAAKG,EAAWC,GAC1EC,EAAG,CAAC,CAAC,CACb,EAAGpB,EAAIqB,GAASA,EAAM,OAAO,CAACnB,EAAGc,IAAMd,IAAM,QAAgBA,EAAE,KAAK,MAAM,GAAG,EAAE,OAASc,EAAE,KAAK,MAAM,GAAG,EAAE,OAAjDA,EAA8Dd,EAAG,MAAS,CAAC,EAAGF,EAAIsB,GAAK,CAAC,CAACA,GAAKT,EAAM,IAAI,QAAQ,OAAO,EAAI,EAAE,CAAC,CAC1L,CACA,oBAAoBU,EAAG,CACrB,MAAO,qCAAqCA,CAAC,MAC/C,CACF,EACMC,EAAN,KAA+B,CAC7B,IAAI,2BAA4B,CAC9B,OAAO,KAAK,GAAG,2BAA2B,mBAAmB,CAC/D,CACA,YAAY3B,EAAUC,EAAIC,EAAQ,CAChC,KAAK,SAAWF,EAChB,KAAK,GAAKC,EACV,KAAK,OAASC,CAChB,CACA,SAAS0B,EAAOZ,EAAO,CACrB,GAAIA,EAAM,IAAI,QAAQ,OAAO,EAAI,GAC/B,QAAQ,IAAI,aAAaA,EAAM,GAAG,EAAE,EACpC,KAAK,OAAO,cAAcA,EAAM,GAAG,MAC9B,CACL,IAAIC,EAAMD,EAAM,IACZC,EAAI,QAAQ,GAAG,IAAM,KACvBA,EAAMD,EAAM,IAAI,OAAO,EAAGC,EAAI,QAAQ,GAAG,CAAC,GAE5C,IAAMC,EAAiB,QAAUD,EAAI,OAAO,CAAC,EAAE,MAAM,GAAG,EAAE,OAAO,CAACZ,EAAGc,EAAGC,IAAM,CAAC,GAAGf,EAAGe,IAAM,EAAI,IAAID,CAAC,GAAK,GAAGd,EAAEe,EAAI,CAAC,CAAC,IAAID,CAAC,EAAE,EAAG,CAAC,CAAC,EAAE,IAAId,GAAK,KAAK,oBAAoBA,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAI,SAAS,mBAAmB,qCAAqC,KAAK,QAAQ,MAAM,CAAC,GAC9Q,KAAK,0BAA0B,aAAaa,CAAc,EAAE,KAAKf,EAAIqB,GAASA,EAAM,OAAO,CAACnB,EAAGc,IAAMd,IAAM,QAAgBA,EAAE,KAAK,MAAM,GAAG,EAAE,OAASc,EAAE,KAAK,MAAM,GAAG,EAAE,OAAjDA,EAA8Dd,EAAG,MAAS,CAAC,EAAGF,EAAI0B,GAAa,CACpN,IAAMC,EAAUd,EAAM,IAAI,OAAO,CAAC,EAAE,MAAM,GAAG,EAAE,MAAMa,EAAU,KAAK,MAAM,GAAG,EAAE,OAAS,CAAC,EAAE,KAAK,GAAG,EACnG,MAAO,CAACA,EAAWC,CAAO,CAC5B,CAAC,CAAC,EAAE,UAAU,CAAC,CAACD,EAAWC,CAAO,IAAM,CAEtC,KAAK,OAAO,SAAS,CAAC,QAAQ,CAAC,CAIjC,CAAC,CACH,CACF,CACA,oBAAoBJ,EAAG,CACrB,MAAO,qCAAqCA,CAAC,MAC/C,CACF,EACMK,EAAmB,CAAC/B,EAAUC,EAAIC,IAAW,CACjD,IAAM8B,EAAkB,IAAIjC,EAAyBC,EAAUC,EAAIC,CAAM,EACnE+B,EAAmB,IAAIlB,EAA0Bf,EAAUC,EAAIC,CAAM,EACrEgC,EAAkB,IAAIP,EAAyB3B,EAAUC,EAAIC,CAAM,EACzE,OAAO,IAAIL,EAAgB,CACzB,GAAI,SACJ,MAAO,SACP,gBAAAmC,EACA,iBAAAC,EACA,gBAAAC,CACF,CAAC,CACH,EACIC,GAAgC,IAAM,CACxC,MAAMA,CAAgB,CACpB,YAAYC,EAAKlC,EAAQF,EAEzBC,EAAI,CAEFmC,EAAI,SAASL,EAAiB/B,EAAUC,EAAIC,CAAM,CAAC,CACrD,CACA,MAAO,CACL,KAAK,UAAO,SAAiCmC,EAAmB,CAC9D,OAAO,IAAKA,GAAqBF,GAAoB,qBAAY,oBAAkB,EAAM,qBAAY,QAAM,EAAM,qBAASG,CAAS,EAAM,qBAAY,gBAAc,CAAC,CACtK,CACF,CACA,MAAO,CACL,KAAK,UAAyB,6BAAiB,CAC7C,KAAMH,CACR,CAAC,CACH,CACA,MAAO,CACL,KAAK,UAAyB,6BAAiB,CAC7C,QAAS,CAACI,CAAY,CACxB,CAAC,CACH,CACF,CACA,OAAOJ,CACT,GAAG",
  "names": ["CommonModule", "i0", "SITE_NAME", "i1", "AliasPlugin", "map", "tap", "catchError", "PanelPage", "PanelPageRouterComponent", "createMatcher", "EditPanelPageComponent", "createEditMatcher", "of", "i2", "i3", "PagealiasPlugin", "AliasPlugin", "PagealiasLoadingStrategy", "siteName", "es", "router", "map", "pp", "p", "o", "PanelPage", "a", "b", "tap", "createMatcher", "PanelPageRouterComponent", "createEditMatcher", "EditPanelPageComponent", "PagealiasMatchingStrategy", "state", "url", "matchPathQuery", "c", "i", "catchError", "e", "of", "pages", "m", "v", "PagealiasRedirectHandler", "route", "panelPage", "argPath", "pagealiasFactory", "loadingStrategy", "matchingStrategy", "redirectHandler", "PagealiasModule", "apm", "__ngFactoryType__", "SITE_NAME", "CommonModule"]
}
