{
  "version": 3,
  "sources": ["../../idb-keyval/dist/index.js"],
  "sourcesContent": ["function promisifyRequest(request) {\n  return new Promise((resolve, reject) => {\n    // @ts-ignore - file size hacks\n    request.oncomplete = request.onsuccess = () => resolve(request.result);\n    // @ts-ignore - file size hacks\n    request.onabort = request.onerror = () => reject(request.error);\n  });\n}\nfunction createStore(dbName, storeName) {\n  let dbp;\n  const getDB = () => {\n    if (dbp) return dbp;\n    const request = indexedDB.open(dbName);\n    request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n    dbp = promisifyRequest(request);\n    dbp.then(db => {\n      // It seems like Safari sometimes likes to just close the connection.\n      // It's supposed to fire this event when that happens. Let's hope it does!\n      db.onclose = () => dbp = undefined;\n    }, () => {});\n    return dbp;\n  };\n  return (txMode, callback) => getDB().then(db => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n  if (!defaultGetStoreFunc) {\n    defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n  }\n  return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n  return customStore('readonly', store => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n  return customStore('readwrite', store => {\n    store.put(value, key);\n    return promisifyRequest(store.transaction);\n  });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic \u2013 if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n  return customStore('readwrite', store => {\n    entries.forEach(entry => store.put(entry[1], entry[0]));\n    return promisifyRequest(store.transaction);\n  });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n  return customStore('readonly', store => Promise.all(keys.map(key => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n  return customStore('readwrite', store =>\n  // Need to create the promise manually.\n  // If I try to chain promises, the transaction closes in browsers\n  // that use a promise polyfill (IE10/11).\n  new Promise((resolve, reject) => {\n    store.get(key).onsuccess = function () {\n      try {\n        store.put(updater(this.result), key);\n        resolve(promisifyRequest(store.transaction));\n      } catch (err) {\n        reject(err);\n      }\n    };\n  }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n  return customStore('readwrite', store => {\n    store.delete(key);\n    return promisifyRequest(store.transaction);\n  });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n  return customStore('readwrite', store => {\n    keys.forEach(key => store.delete(key));\n    return promisifyRequest(store.transaction);\n  });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n  return customStore('readwrite', store => {\n    store.clear();\n    return promisifyRequest(store.transaction);\n  });\n}\nfunction eachCursor(store, callback) {\n  store.openCursor().onsuccess = function () {\n    if (!this.result) return;\n    callback(this.result);\n    this.result.continue();\n  };\n  return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n  return customStore('readonly', store => {\n    // Fast path for modern browsers\n    if (store.getAllKeys) {\n      return promisifyRequest(store.getAllKeys());\n    }\n    const items = [];\n    return eachCursor(store, cursor => items.push(cursor.key)).then(() => items);\n  });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n  return customStore('readonly', store => {\n    // Fast path for modern browsers\n    if (store.getAll) {\n      return promisifyRequest(store.getAll());\n    }\n    const items = [];\n    return eachCursor(store, cursor => items.push(cursor.value)).then(() => items);\n  });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n  return customStore('readonly', store => {\n    // Fast path for modern browsers\n    // (although, hopefully we'll get a simpler path some day)\n    if (store.getAll && store.getAllKeys) {\n      return Promise.all([promisifyRequest(store.getAllKeys()), promisifyRequest(store.getAll())]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n    }\n    const items = [];\n    return customStore('readonly', store => eachCursor(store, cursor => items.push([cursor.key, cursor.value])).then(() => items));\n  });\n}\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };"],
  "mappings": "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",
  "names": ["promisifyRequest", "request", "resolve", "reject", "createStore", "dbName", "storeName", "dbp", "getDB", "db", "txMode", "callback", "defaultGetStoreFunc", "defaultGetStore", "get", "key", "customStore", "store", "set", "value", "setMany", "entries", "entry", "getMany", "keys", "update", "updater", "err", "del", "delMany", "clear", "eachCursor", "items", "cursor", "values", "i"]
}
