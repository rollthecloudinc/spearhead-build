{
  "version": 3,
  "sources": ["../../@rollthecloudinc/media/fesm2022/rollthecloudinc-media.mjs"],
  "sourcesContent": ["import * as i0 from '@angular/core';\nimport { Component, NgModule, InjectionToken, Inject, Injectable } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport * as i1 from '@rollthecloudinc/content';\nimport { ContentPlugin } from '@rollthecloudinc/content';\nimport { throwError, forkJoin, of, Observable, firstValueFrom } from 'rxjs';\nimport * as i4 from '@rollthecloudinc/awcog';\nimport { COGNITO_SETTINGS } from '@rollthecloudinc/awcog';\nimport { catchError, map } from 'rxjs/operators';\nimport { Upload } from '@aws-sdk/lib-storage';\nimport * as uuid from 'uuid';\nimport { fromCognitoIdentityPool } from '@aws-sdk/credential-provider-cognito-identity';\nimport { CognitoIdentityClient } from '@aws-sdk/client-cognito-identity';\nimport { S3Client } from '@aws-sdk/client-s3';\nimport * as i1$1 from '@angular/common/http';\nimport * as i2 from '@rollthecloudinc/auth';\nlet MediafilePaneRendererComponent = /*#__PURE__*/(() => {\n  class MediafilePaneRendererComponent {\n    static {\n      this.\u0275fac = function MediafilePaneRendererComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || MediafilePaneRendererComponent)();\n      };\n    }\n    static {\n      this.\u0275cmp = /* @__PURE__ */i0.\u0275\u0275defineComponent({\n        type: MediafilePaneRendererComponent,\n        selectors: [[\"classifieds-ui-mediafile-pane-renderer\"]],\n        standalone: false,\n        decls: 1,\n        vars: 0,\n        template: function MediafilePaneRendererComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.\u0275\u0275text(0, \"Media File\");\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return MediafilePaneRendererComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nconst mediafileContentPluginFactory = () => {\n  return new ContentPlugin({\n    id: 'media_file',\n    title: 'Media File',\n    selectionComponent: undefined,\n    editorComponent: undefined,\n    renderComponent: MediafilePaneRendererComponent,\n    handler: undefined\n  });\n};\nlet MediaModule = /*#__PURE__*/(() => {\n  class MediaModule {\n    constructor(cpm) {\n      cpm.register(mediafileContentPluginFactory());\n    }\n    static {\n      this.\u0275fac = function MediaModule_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || MediaModule)(i0.\u0275\u0275inject(i1.ContentPluginManager));\n      };\n    }\n    static {\n      this.\u0275mod = /* @__PURE__ */i0.\u0275\u0275defineNgModule({\n        type: MediaModule\n      });\n    }\n    static {\n      this.\u0275inj = /* @__PURE__ */i0.\u0275\u0275defineInjector({\n        imports: [CommonModule /*, HttpClientModule*/]\n      });\n    }\n  }\n  return MediaModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nconst MEDIA_SETTINGS = /*#__PURE__*/new InjectionToken('Media Settings');\nclass MediaSettings {\n  constructor(data) {\n    if (data) {\n      this.endpointUrl = data.endpointUrl;\n      this.cloudinaryUrl = data.cloudinaryUrl;\n      this.uploadPreset = data.uploadPreset;\n      this.imageUrl = data.imageUrl;\n      this.bucket = data.bucket;\n      this.prefix = data.prefix;\n    }\n  }\n}\nclass MediaFile {\n  constructor(data) {\n    if (data) {\n      this.id = data.id;\n      this.contentType = data.contentType;\n      this.contentDisposition = data.contentDisposition;\n      this.path = data.path;\n      this.fileName = data.fileName;\n      this.length = data.length;\n      this.extension = data.extension ? data.extension : undefined;\n      this.realPath = data.realPath && data.realPath !== '' ? data.realPath : undefined;\n    }\n  }\n}\nclass CloudinaryUploadResponse {\n  constructor(data) {\n    if (data) {\n      this.public_id = data.public_id;\n      this.format = data.format;\n      this.original_filename = data.original_filename;\n      this.bytes = data.bytes;\n    }\n  }\n}\n\n// import * as mime from 'mime-types';\nlet FilesService = /*#__PURE__*/(() => {\n  class FilesService {\n    constructor(settings, cognitoSettings, http, authFacade) {\n      this.settings = settings;\n      this.cognitoSettings = cognitoSettings;\n      this.http = http;\n      this.authFacade = authFacade;\n    }\n    bulkUpload({\n      files,\n      fileNameOverride,\n      nocache\n    }) {\n      const requests$ = [];\n      files.forEach(f => {\n        if (f) {\n          const formData = new FormData();\n          formData.append('File', f, fileNameOverride ? fileNameOverride : f.name);\n          requests$.push(this.http.post(this.settings.endpointUrl, formData).pipe(catchError(e => {\n            return throwError(new Error(\"Error uploading images.\"));\n          })));\n        }\n      });\n      return requests$.length > 0 ? forkJoin(requests$) : of([]);\n    }\n    // github will be favored\n    bulkUploadS3({\n      files,\n      fileNameOverride,\n      nocache\n    }) {\n      const requests$ = [];\n      files.forEach(f => {\n        if (f) {\n          /*const formData = new FormData();\n          formData.append('File', f, f.name);\n          requests$.push(this.http.post<MediaFile>(this.settings.endpointUrl, formData).pipe(\n            catchError(e => {\n              return throwError(new Error(\"Error uploading images.\"));\n            })\n          ));*/\n          requests$.push(new Observable(obs => {\n            const id = fileNameOverride ? fileNameOverride : uuid.v4();\n            const [_, ext] = f.name.split('.', 2);\n            const fileName = id + (/*'.' + mime.extension(f.type);*/ext ? '.' + ext : '');\n            const upload = new Upload({\n              client: this.buildClient(),\n              params: {\n                Bucket: this.settings.bucket,\n                Key: this.settings.prefix + fileName,\n                Body: f,\n                ContentType: f.type,\n                ...(nocache ? {\n                  CacheControl: 'no-cache'\n                } : {})\n                //ContentEncoding: 'gzip'\n              }\n            });\n            upload.done().then(() => {\n              obs.next(new MediaFile({\n                id,\n                contentType: f.type,\n                contentDisposition: '',\n                path: fileName,\n                realPath: this.settings.prefix + fileName,\n                length: f.size,\n                fileName: f.name,\n                extension: /*mime.extension(f.type)*/ext && ext !== '' ? ext : undefined\n              }));\n              obs.complete();\n            });\n          }));\n        }\n      });\n      return requests$.length > 0 ? forkJoin(requests$) : of([]);\n    }\n    convertToFiles(mediaFiles) {\n      const requests$ = mediaFiles.map(f => new Observable(obs => {\n        fetch(`${this.settings.imageUrl}/${f.path}`).then(r => {\n          r.blob().then(d => {\n            new Promise(resolve => {\n              let reader = new FileReader();\n              reader.onload = () => resolve(reader.result);\n              reader.readAsDataURL(d);\n            }).then(d2 => {\n              const arrayBufferFromBase64 = this.convertDataURIToBinary(d2);\n              const file = new File([arrayBufferFromBase64], f.fileName, {\n                type: f.contentType\n              });\n              obs.next(file);\n              obs.complete();\n            });\n          });\n        });\n      }));\n      return forkJoin(requests$);\n    }\n    convertDataURIToBinary(dataURI) {\n      var BASE64_MARKER = ';base64,';\n      var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\n      var base64 = dataURI.substring(base64Index);\n      var raw = window.atob(base64);\n      var rawLength = raw.length;\n      var array = new Uint8Array(new ArrayBuffer(rawLength));\n      for (var i = 0; i < rawLength; i++) {\n        array[i] = raw.charCodeAt(i);\n      }\n      return array;\n    }\n    buildClient() {\n      return new S3Client({\n        region: this.cognitoSettings.region,\n        credentials: fromCognitoIdentityPool({\n          client: new CognitoIdentityClient({\n            region: this.cognitoSettings.region\n          }),\n          identityPoolId: this.cognitoSettings.identityPoolId,\n          logins: {\n            [`cognito-idp.${this.cognitoSettings.region}.amazonaws.com/${this.cognitoSettings.userPoolId}`]: () => firstValueFrom(this.authFacade.getUser$.pipe(map(u => u ? u.id_token : undefined)))\n          }\n        })\n      });\n    }\n    isImage({\n      file\n    }) {\n      return file.type && file.type.indexOf('image/') === 0;\n    }\n    isVideo({\n      file\n    }) {\n      return file.type && file.type.indexOf('video/') === 0;\n    }\n    static {\n      this.\u0275fac = function FilesService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || FilesService)(i0.\u0275\u0275inject(MEDIA_SETTINGS), i0.\u0275\u0275inject(COGNITO_SETTINGS), i0.\u0275\u0275inject(i1$1.HttpClient), i0.\u0275\u0275inject(i2.AuthFacade));\n      };\n    }\n    static {\n      this.\u0275prov = /* @__PURE__ */i0.\u0275\u0275defineInjectable({\n        token: FilesService,\n        factory: FilesService.\u0275fac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return FilesService;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { CloudinaryUploadResponse, FilesService, MEDIA_SETTINGS, MediaFile, MediaModule, MediaSettings, MediafilePaneRendererComponent };\n"],
  "mappings": "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",
  "names": ["i0", "InjectionToken", "CommonModule", "i1", "ContentPlugin", "throwError", "forkJoin", "of", "Observable", "firstValueFrom", "COGNITO_SETTINGS", "catchError", "map", "Upload", "fromCognitoIdentityPool", "CognitoIdentityClient", "S3Client", "i1$1", "i2", "MediafilePaneRendererComponent", "__ngFactoryType__", "rf", "ctx", "mediafileContentPluginFactory", "ContentPlugin", "MediaModule", "cpm", "CommonModule", "MEDIA_SETTINGS", "InjectionToken", "MediaSettings", "data", "MediaFile", "CloudinaryUploadResponse", "FilesService", "settings", "cognitoSettings", "http", "authFacade", "files", "fileNameOverride", "nocache", "requests$", "f", "formData", "catchError", "e", "throwError", "forkJoin", "of", "Observable", "obs", "id", "v4_default", "_", "ext", "fileName", "Upload", "__spreadValues", "mediaFiles", "r", "d", "resolve", "reader", "d2", "arrayBufferFromBase64", "file", "dataURI", "BASE64_MARKER", "base64Index", "base64", "raw", "rawLength", "array", "i", "S3Client", "fromCognitoIdentityPool", "CognitoIdentityClient", "firstValueFrom", "map", "u", "COGNITO_SETTINGS"]
}
