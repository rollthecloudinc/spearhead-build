{
  "version": 3,
  "sources": ["../../@rollthecloudinc/alias/fesm2022/rollthecloudinc-alias.mjs"],
  "sourcesContent": ["import * as i0 from '@angular/core';\nimport { Component, NgModule, Injectable, Inject } from '@angular/core';\nimport * as i1$1 from '@angular/router';\nimport { RouterModule } from '@angular/router';\nimport * as i2 from '@rollthecloudinc/utils';\nimport { UtilsModule, SITE_NAME } from '@rollthecloudinc/utils';\nimport * as i1 from '@ngrx/store';\nimport * as i3 from '@ngrx/data';\nimport * as i1$2 from '@rollthecloudinc/plugin';\nimport { Plugin, BasePluginManager, PluginDef } from '@rollthecloudinc/plugin';\nimport { of, forkJoin } from 'rxjs';\nimport { tap, switchMap, defaultIfEmpty, map } from 'rxjs/operators';\nlet CatchAllRouterComponent = /*#__PURE__*/(() => {\n  class CatchAllRouterComponent {\n    // panelPageListItemsService: EntityCollectionService<PanelPageListItem>;\n    constructor(routerStore, router, es) {\n      this.routerStore = routerStore;\n      this.router = router;\n      // this.panelPageListItemsService = es.getEntityCollectionService('PanelPageListItem');\n    }\n    ngOnInit() {\n      /*const { selectCurrentRoute } = getSelectors((state: any) => state.router);\n      console.log('routing page...');\n      this.routerStore.pipe(\n        select(selectCurrentRoute),\n        map(route => [(route as ActivatedRouteSnapshot).url.reduce<Array<string>>((p, c, i) => [ ...p, i === 0 ? `/${c.path}` : `${p[i - 1]}/${c.path}` ], []), route]),\n        map(([paths, route])  => ['path=' + paths.join('&path='), route]),\n        switchMap(([qs, route]) => this.panelPageListItemsService.getWithQuery(qs).pipe(\n          catchError(e => of<Array<PanelPageListItem>>([])),\n          tap(pages => console.log(pages)),\n          map(pages => [pages.reduce<PanelPageListItem>((p, c) => p === undefined ? c : p.path.split('/').length < c.path.split('/').length ? c : p , undefined), route])\n        )),\n        take(1)\n      ).subscribe(([panelPage, route]) => {\n        if(panelPage) {\n          const argPath = (route as ActivatedRouteSnapshot).url.map(s => s.path).slice(panelPage.path.split('/').length - 1).join('/');\n          this.router.navigateByUrl(`/pages/panelpage/${panelPage.id}/${argPath}?${qs.stringify(route.queryParams)}`, {skipLocationChange: true, queryParams: { ...((route as ActivatedRouteSnapshot).queryParams) }, fragment: (route as ActivatedRouteSnapshot).fragment });\n        }\n      });*/\n    }\n    static {\n      this.\u0275fac = function CatchAllRouterComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CatchAllRouterComponent)(i0.\u0275\u0275directiveInject(i1.Store), i0.\u0275\u0275directiveInject(i1$1.Router), i0.\u0275\u0275directiveInject(i3.EntityServices));\n      };\n    }\n    static {\n      this.\u0275cmp = /* @__PURE__ */i0.\u0275\u0275defineComponent({\n        type: CatchAllRouterComponent,\n        selectors: [[\"druid-alias-catch-all-router\"]],\n        standalone: false,\n        decls: 2,\n        vars: 0,\n        template: function CatchAllRouterComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.\u0275\u0275elementStart(0, \"p\");\n            i0.\u0275\u0275text(1, \"Page Not Found\");\n            i0.\u0275\u0275elementEnd();\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return CatchAllRouterComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nconst routes = [\n  // { path: '**', component: CatchAllRouterComponent, canActivate: [ CatchAllGuard ] }\n];\nlet AliasModule = /*#__PURE__*/(() => {\n  class AliasModule {\n    static {\n      this.\u0275fac = function AliasModule_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AliasModule)();\n      };\n    }\n    static {\n      this.\u0275mod = /* @__PURE__ */i0.\u0275\u0275defineNgModule({\n        type: AliasModule\n      });\n    }\n    static {\n      this.\u0275inj = /* @__PURE__ */i0.\u0275\u0275defineInjector({\n        imports: [UtilsModule, RouterModule.forChild(routes)]\n      });\n    }\n  }\n  return AliasModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nclass AliasPlugin extends Plugin {\n  constructor(data) {\n    super(data);\n    if (data) {\n      this.loadingStrategy = data.loadingStrategy;\n      this.matchingStrategy = data.matchingStrategy;\n      this.redirectHandler = data.redirectHandler;\n    }\n  }\n}\nlet AliasPluginManager = /*#__PURE__*/(() => {\n  class AliasPluginManager extends BasePluginManager {\n    constructor(pcm, moduleLoader) {\n      super(pcm, moduleLoader);\n    }\n    pluginDef() {\n      return of(new PluginDef({\n        name: 'alias'\n      }));\n    }\n    static {\n      this.\u0275fac = function AliasPluginManager_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AliasPluginManager)(i0.\u0275\u0275inject(i1$2.PluginConfigurationManager), i0.\u0275\u0275inject(i2.ModuleLoaderService));\n      };\n    }\n    static {\n      this.\u0275prov = /* @__PURE__ */i0.\u0275\u0275defineInjectable({\n        token: AliasPluginManager,\n        factory: AliasPluginManager.\u0275fac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AliasPluginManager;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet CatchAllGuard = /*#__PURE__*/(() => {\n  class CatchAllGuard {\n    // panelPageListItemsService: EntityCollectionService<PanelPageListItem>;\n    constructor(siteName, router, apm, es) {\n      this.siteName = siteName;\n      this.router = router;\n      this.apm = apm;\n      this.routesLoaded = false;\n      // this.panelPageListItemsService = es.getEntityCollectionService('PanelPageListItem');\n    }\n    canActivate(route, state) {\n      console.log('catch all alias hit');\n      return new Promise(res => {\n        console.log('catch all promise top');\n        this.apm.getPlugins().pipe(tap(p => console.log('catch all stream checkpoint 1', p ? p.size : 0)), switchMap(plugins => forkJoin(!this.routesLoaded ? Array.from(plugins).map(([_, p]) => p.loadingStrategy.load()) : []).pipe(defaultIfEmpty(undefined))), tap(() => console.log('catch all stream checkpoint 2')), tap(() => this.routesLoaded = true), switchMap(() => this.apm.getPlugins()), tap(() => console.log('catch all stream checkpoint 3')), switchMap(plugins => plugins.size === 0 ? of([]) : forkJoin(Array.from(plugins).map(([_, p]) => p.matchingStrategy.match(state).pipe(map(m => [p, m]))))), tap(() => console.log('catch all stream checkpoint 4'))).subscribe(pp => {\n          console.log(`routes loaded: ${this.routesLoaded ? 'y' : 'n'}`);\n          const matchedPlugin = pp.map(([p, m], _) => m ? p : undefined).find(p => p !== undefined);\n          if (matchedPlugin !== undefined) {\n            console.log(`alias gaurd state: ${state.url}`);\n            const urlTree = this.router.parseUrl(state.url);\n            // matchedPlugin.redirectHandler.redirect(route, state);\n            // res(false);\n            res(urlTree);\n          } else {\n            res(true);\n          }\n        });\n      });\n    }\n    static {\n      this.\u0275fac = function CatchAllGuard_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CatchAllGuard)(i0.\u0275\u0275inject(SITE_NAME), i0.\u0275\u0275inject(i1$1.Router), i0.\u0275\u0275inject(AliasPluginManager), i0.\u0275\u0275inject(i3.EntityServices));\n      };\n    }\n    static {\n      this.\u0275prov = /* @__PURE__ */i0.\u0275\u0275defineInjectable({\n        token: CatchAllGuard,\n        factory: CatchAllGuard.\u0275fac\n      });\n    }\n  }\n  return CatchAllGuard;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/*\n * Public API Surface of alias\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { AliasModule, AliasPlugin, AliasPluginManager, CatchAllGuard, CatchAllRouterComponent };\n"],
  "mappings": "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",
  "names": ["i0", "i1$1", "RouterModule", "i2", "UtilsModule", "SITE_NAME", "i1", "i3", "i1$2", "Plugin", "BasePluginManager", "PluginDef", "of", "forkJoin", "tap", "switchMap", "defaultIfEmpty", "map", "CatchAllRouterComponent", "routerStore", "router", "es", "__ngFactoryType__", "rf", "ctx", "routes", "AliasModule", "AliasPlugin", "data", "AliasPluginManager", "pcm", "moduleLoader", "CatchAllGuard", "siteName", "apm", "route", "state", "res", "p", "plugins", "_", "m", "pp", "urlTree"]
}
