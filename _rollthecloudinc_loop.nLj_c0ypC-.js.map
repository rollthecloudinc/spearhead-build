{
  "version": 3,
  "sources": ["../../@rollthecloudinc/loop/fesm2022/rollthecloudinc-loop.mjs"],
  "sourcesContent": ["import { CommonModule } from '@angular/common';\nimport * as i0 from '@angular/core';\nimport { forwardRef, Input, Component, NgModule } from '@angular/core';\nimport * as i1 from '@angular/forms';\nimport { NG_VALUE_ACCESSOR, NG_VALIDATORS, ReactiveFormsModule } from '@angular/forms';\nimport { MaterialModule } from '@rollthecloudinc/material';\nimport { InlineContext, ContextModule } from '@rollthecloudinc/context';\nimport * as i1$1 from '@rollthecloudinc/datasource';\nimport { DatasourcePlugin, Dataset, Datasource, DatasourceModule } from '@rollthecloudinc/datasource';\nimport { BehaviorSubject, of, forkJoin } from 'rxjs';\nimport { map, switchMap, take, defaultIfEmpty } from 'rxjs/operators';\nimport * as i2 from '@rollthecloudinc/attributes';\nlet LoopDatasourceFormComponent = /*#__PURE__*/(() => {\n  class LoopDatasourceFormComponent {\n    set settings(settings) {\n      this.settings$.next(settings);\n    }\n    constructor(fb) {\n      this.fb = fb;\n      this.contexts = [];\n      this.settings$ = new BehaviorSubject(undefined);\n      this.datasource$ = new BehaviorSubject(undefined);\n      this.formGroup = this.fb.group({});\n      /*settingsSub = this.settings$.pipe(\n        map(s => s ? new CrudAdaptorDatasource (this.attributeSerializer.deserializeAsObject(s)) : undefined),\n        tap(ds => setTimeout(() => this.datasource$.next(ds)))\n      ).subscribe(ds => {\n        if (ds) {\n          this.formGroup.get('adaptorName').setValue(ds.adaptorName);\n          this.formGroup.get('optionsString').setValue(ds.optionsString ? ds.optionsString : '');\n          this.formGroup.get('paramsString').setValue(ds.paramsString ? ds.paramsString : '');\n        } else {\n          this.formGroup.get('adaptorName').setValue('');\n          this.formGroup.get('optionsString').setValue('');\n          this.formGroup.get('paramsString').setValue('');\n          setTimeout(() => this.optionValues$.next([]), 2);\n          setTimeout(() => this.optionValues$.next([]), 2);\n        }\n      });*/\n      this.onTouched = () => {};\n    }\n    ngOnInit() {}\n    writeValue(val) {\n      if (val) {\n        this.formGroup.setValue(val, {\n          emitEvent: false\n        });\n      }\n    }\n    registerOnChange(fn) {\n      this.formGroup.valueChanges.subscribe(fn);\n    }\n    registerOnTouched(fn) {\n      this.onTouched = fn;\n    }\n    setDisabledState(isDisabled) {\n      if (isDisabled) {\n        this.formGroup.disable();\n      } else {\n        this.formGroup.enable();\n      }\n    }\n    validate(c) {\n      return this.formGroup.valid ? null : this.formGroup.errors;\n    }\n    static {\n      this.\u0275fac = function LoopDatasourceFormComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || LoopDatasourceFormComponent)(i0.\u0275\u0275directiveInject(i1.UntypedFormBuilder));\n      };\n    }\n    static {\n      this.\u0275cmp = /* @__PURE__ */i0.\u0275\u0275defineComponent({\n        type: LoopDatasourceFormComponent,\n        selectors: [[\"classifieds-ui-loop-datasource-form\"]],\n        inputs: {\n          contexts: \"contexts\",\n          settings: \"settings\"\n        },\n        standalone: false,\n        features: [i0.\u0275\u0275ProvidersFeature([{\n          provide: NG_VALUE_ACCESSOR,\n          useExisting: forwardRef(() => LoopDatasourceFormComponent),\n          multi: true\n        }, {\n          provide: NG_VALIDATORS,\n          useExisting: forwardRef(() => LoopDatasourceFormComponent),\n          multi: true\n        }])],\n        decls: 1,\n        vars: 1,\n        consts: [[3, \"formGroup\"]],\n        template: function LoopDatasourceFormComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.\u0275\u0275element(0, \"div\", 0);\n          }\n          if (rf & 2) {\n            i0.\u0275\u0275property(\"formGroup\", ctx.formGroup);\n          }\n        },\n        dependencies: [i1.NgControlStatusGroup, i1.FormGroupDirective],\n        encapsulation: 2\n      });\n    }\n  }\n  return LoopDatasourceFormComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nlet LoopDatasourceComponent = /*#__PURE__*/(() => {\n  class LoopDatasourceComponent {\n    constructor(controlContainer) {\n      this.controlContainer = controlContainer;\n      this.settings = [];\n      this.contexts = [];\n    }\n    static {\n      this.\u0275fac = function LoopDatasourceComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || LoopDatasourceComponent)(i0.\u0275\u0275directiveInject(i1.ControlContainer));\n      };\n    }\n    static {\n      this.\u0275cmp = /* @__PURE__ */i0.\u0275\u0275defineComponent({\n        type: LoopDatasourceComponent,\n        selectors: [[\"classifieds-ui-loop-datasource\"]],\n        inputs: {\n          settings: \"settings\",\n          contexts: \"contexts\"\n        },\n        standalone: false,\n        decls: 2,\n        vars: 3,\n        consts: [[3, \"formGroup\"], [\"formControlName\", \"settings\", 3, \"settings\", \"contexts\"]],\n        template: function LoopDatasourceComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.\u0275\u0275elementContainerStart(0, 0);\n            i0.\u0275\u0275element(1, \"classifieds-ui-loop-datasource-form\", 1);\n            i0.\u0275\u0275elementContainerEnd();\n          }\n          if (rf & 2) {\n            i0.\u0275\u0275property(\"formGroup\", ctx.controlContainer.control);\n            i0.\u0275\u0275advance();\n            i0.\u0275\u0275property(\"settings\", ctx.settings)(\"contexts\", ctx.contexts);\n          }\n        },\n        dependencies: [i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, LoopDatasourceFormComponent],\n        encapsulation: 2\n      });\n    }\n  }\n  return LoopDatasourceComponent;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nclass LoopDatasource {\n  constructor(data) {\n    if (data) {}\n  }\n}\nconst loopDatasourcePluginFactory = (attrbuteSerializer, datasourceEvaluator) => {\n  return new DatasourcePlugin({\n    id: 'loop',\n    title: 'loop',\n    editor: LoopDatasourceComponent,\n    fetch: ({\n      settings,\n      dataset,\n      datasource,\n      metadata,\n      datasources\n    }) => of(new Dataset()).pipe(map(() => attrbuteSerializer.deserializeAsObject(settings)), map(s => s ? new LoopDatasource(s) : undefined), switchMap(s => forkJoin(dataset ? dataset.results.map(row => datasourceEvaluator.evalDatasource({\n      datasource: new Datasource({\n        plugin: 'data',\n        renderer: datasource.renderer,\n        settings: attrbuteSerializer.serialize({\n          data: JSON.stringify(dataset.results)\n        }, 'root').attributes\n      }),\n      datasources,\n      metadata: new Map([...(metadata ? Array.from(metadata).filter(([k]) => k !== 'contexts') : []), ['contexts', [...(metadata.has('contexts') && Array.isArray(metadata.get('contexts')) ? metadata.get('contexts').filter(ctx => ctx.name !== '_root') : []), new InlineContext({\n        name: \"_root\",\n        adaptor: 'data',\n        data: row\n      })]]])\n    }).pipe(take(1))) : []).pipe(map(sets => new Dataset({\n      results: sets.reduce((p, c) => [...p, ...c.results], [])\n    })), defaultIfEmpty(new Dataset({\n      results: []\n    })))))\n  });\n};\nlet LoopModule = /*#__PURE__*/(() => {\n  class LoopModule {\n    constructor(dpm, attributeSerializer, datasourceEvaluator) {\n      [loopDatasourcePluginFactory(attributeSerializer, datasourceEvaluator)].forEach(p => dpm.register(p));\n    }\n    static {\n      this.\u0275fac = function LoopModule_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || LoopModule)(i0.\u0275\u0275inject(i1$1.DatasourcePluginManager), i0.\u0275\u0275inject(i2.AttributeSerializerService), i0.\u0275\u0275inject(i1$1.DatasourceEvaluator));\n      };\n    }\n    static {\n      this.\u0275mod = /* @__PURE__ */i0.\u0275\u0275defineNgModule({\n        type: LoopModule\n      });\n    }\n    static {\n      this.\u0275inj = /* @__PURE__ */i0.\u0275\u0275defineInjector({\n        imports: [CommonModule, ReactiveFormsModule, MaterialModule, ContextModule, DatasourceModule]\n      });\n    }\n  }\n  return LoopModule;\n})();\n(() => {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/*\n * Public API Surface of loop\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { LoopDatasource, LoopDatasourceComponent, LoopDatasourceFormComponent, LoopModule };\n"],
  "mappings": "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",
  "names": ["CommonModule", "i0", "forwardRef", "i1", "NG_VALUE_ACCESSOR", "NG_VALIDATORS", "ReactiveFormsModule", "MaterialModule", "InlineContext", "ContextModule", "i1$1", "DatasourcePlugin", "Dataset", "Datasource", "DatasourceModule", "BehaviorSubject", "of", "forkJoin", "map", "switchMap", "take", "defaultIfEmpty", "i2", "LoopDatasourceFormComponent", "settings", "fb", "val", "fn", "isDisabled", "c", "__ngFactoryType__", "rf", "ctx", "LoopDatasourceComponent", "controlContainer", "LoopDatasource", "data", "loopDatasourcePluginFactory", "attrbuteSerializer", "datasourceEvaluator", "dataset", "datasource", "metadata", "datasources", "s", "row", "k", "sets", "p", "LoopModule", "dpm", "attributeSerializer"]
}
